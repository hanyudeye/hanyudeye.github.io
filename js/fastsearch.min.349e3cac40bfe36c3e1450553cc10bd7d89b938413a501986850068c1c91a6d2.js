var fuse,searchVisible=!1,firstRun=!0,list=document.getElementById("searchResults"),first=list.firstChild,last=list.lastChild,maininput=document.getElementById("searchInput"),resultsAvailable=!1;document.addEventListener("click",e=>{var n=document.getElementById("fastSearch"),s=document.getElementById("search-click"),t=e.target;s==t||s.contains(t)?showSearchInput():n==t||n.contains(t)||searchVisible&&(n.style.display="none",searchVisible=!1)}),document.addEventListener("keydown",function(e){e.metaKey&&e.which===191&&showSearchInput(),e.keyCode==27&&searchVisible&&(document.getElementById("fastSearch").style.display="none",document.activeElement.blur(),searchVisible=!1),e.keyCode==40&&searchVisible&&resultsAvailable&&(e.preventDefault(),document.activeElement==maininput?first.focus():document.activeElement==last?last.focus():document.activeElement.parentElement.nextSibling.firstElementChild.focus()),e.keyCode==38&&searchVisible&&resultsAvailable&&(e.preventDefault(),document.activeElement==maininput?maininput.focus():document.activeElement==first?maininput.focus():document.activeElement.parentElement.previousSibling.firstElementChild.focus())}),document.getElementById("searchInput").onkeyup=function(){executeSearch(this.value)};function showSearchInput(){firstRun&&(loadSearch(),firstRun=!1),searchVisible?(document.getElementById("fastSearch").style.display="none",document.activeElement.blur(),searchVisible=!1):(document.getElementById("fastSearch").style.display="block",document.getElementById("searchInput").focus(),searchVisible=!0)}function fetchJSONFile(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState===4&&n.status===200){var e=JSON.parse(n.responseText);t&&t(e)}},n.open("GET",e),n.send()}function loadSearch(){fetchJSONFile("/index.json",function(e){var t={includeMatches:!0,shouldSort:!0,ignoreLocation:!0,keys:[{name:"title",weight:1},{name:"content",weight:.6}]};fuse=new Fuse(e,t)})}function executeSearch(e){if(e.length==0){document.getElementById("searchResults").setAttribute("style","");return}let t=fuse.search(e),n="";if(t.length===0)resultsAvailable=!1,n='<li class="noSearchResult">无结果</li>';else{permalinkList=[],searchItemCount=0;for(let e in t){if(permalinkList.includes(t[e].item.permalink))continue;permalinkList.push(t[e].item.permalink),searchItemCount+=1,title=t[e].item.title,content=t[e].item.content.slice(0,50);for(const n of t[e].matches)n.key=="title"?(startIndex=n.indices[0][0],endIndex=n.indices[0][1]+1,highText='<span class="search-highlight">'+n.value.slice(startIndex,endIndex)+"</span>",title=n.value.slice(0,startIndex)+highText+n.value.slice(endIndex)):n.key=="content"&&(startIndex=n.indices[0][0],endIndex=n.indices[0][1]+1,highText='<span class="search-highlight">'+n.value.slice(startIndex,endIndex)+"</span>",highText=""+n.value.slice(startIndex,endIndex)+"",content=n.value.slice(Math.max(0,startIndex-30),startIndex)+highText+n.value.slice(endIndex,endIndex+30));if(n=n+'<li><a href="'+t[e].item.permalink+'"><span class="title">'+title+'</span><br /> <span class="sc">'+content+"</span></a></li>",searchItemCount>=5)break}resultsAvailable=!0,结果可用=真}document.getElementById("searchResults").setAttribute("style","display: block;"),document.getElementById("searchResults").innerHTML=n,t.length>0&&(first=list.firstChild.firstElementChild,last=list.lastChild.firstElementChild)}